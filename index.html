<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المرجعية الإسلامية - أذكار الصباح</title>

    <meta name="pi-domain-verification" content="bebccf6428">

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #1b5e20; /* أخضر إسلامي غامق */
            --secondary-color: #c49a6c; /* ذهبي/برونزي */
            --bg-color: #fdfbf7; /* لون كريمي هادئ */
            --card-bg: #ffffff;
            --text-main: #212121;
            --text-accent: #1b5e20;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Amiri', serif; /* الخط الجديد */
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-main);
        }

        /* تنسيق زر وتسجيل دخول باي */
        .pi-login-section {
            width: 100%;
            max-width: 600px;
            text-align: center;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid #d4ac0d;
        }

        #pi-login-btn {
            background-color: var(--secondary-color);
            color: #fff;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-family: 'Segoe UI', sans-serif;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            transition: 0.3s;
        }

        #pi-login-btn:active {
            transform: scale(0.95);
        }

        /* حاوية التطبيق */
        .app-container {
            width: 100%;
            max-width: 600px;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }

        h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1rem;
            color: #666;
            margin-top: 5px;
        }

        /* زر إعادة الضبط */
        .reset-btn {
            background: transparent;
            color: #c0392b;
            border: 1px solid #c0392b;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 0.9rem;
            font-family: 'Segoe UI', Tahoma, sans-serif;
        }

        /* بطاقة الذكر */
        .zekr-card {
            background: var(--card-bg);
            border-right: 5px solid var(--secondary-color);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.04);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s ease;
            position: relative;
        }

        .zekr-card:active {
            transform: scale(0.98);
        }

        .zekr-text {
            font-size: 1.4rem;
            line-height: 2;
            color: var(--text-main);
            text-align: justify;
            margin-bottom: 20px;
            display: block;
        }

        /* منطقة التحكم والعداد */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        .info {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-family: 'Segoe UI', sans-serif;
        }

        /* العداد الدائري الجديد */
        .counter-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(27, 94, 32, 0.3);
            transition: background 0.3s;
            font-family: sans-serif;
        }

        /* حالة الإتمام */
        .completed {
            opacity: 0.6;
            background-color: #f9f9f9;
            border-right-color: #bdc3c7;
        }

        .completed .counter-btn {
            background: #7f8c8d;
            box-shadow: none;
        }

        .completed .zekr-text {
            color: #7f8c8d;
        }

        /* --- النافذة المنبثقة المخصصة (Custom Modal) --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 85%;
            max-width: 350px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-top: 5px solid var(--primary-color);
        }

        .modal-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-confirm {
            background: var(--primary-color);
            color: white;
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

        .btn-cancel {
            background: #ecf0f1;
            color: #7f8c8d;
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

    </style>
</head>
<body>

    <div class="pi-login-section">
        <h4 style="margin: 0 0 10px 0; color: var(--primary-color);">تكامل Pi Network</h4>
        <button id="pi-login-btn" onclick="loginWithPi()">تسجيل الدخول</button>
        <div id="status" style="margin-top: 10px; font-weight: bold; color: var(--primary-color);"></div>
    </div>

    <div class="app-container">
        <header>
            <h1>أذكار الصباح</h1>
            <div class="subtitle">حصن المسلم</div>
            <button class="reset-btn" onclick="showResetModal()">إعادة ضبط العداد</button>
        </header>

        <div id="azkar-list"></div>
    </div>

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-title">تأكيد إعادة الضبط</div>
            <p style="color: #555;">هل تريد البدء من جديد وتصفير جميع العدادات؟</p>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeModal()">إلغاء</button>
                <button class="btn-confirm" onclick="confirmReset()">نعم، ابدأ من جديد</button>
            </div>
        </div>
    </div>

    <script>
        // --- أولاً: أكواد Pi Network ---
        Pi.init({ version: "2.0", sandbox: true });

        async function loginWithPi() {
            try {
                const auth = await Pi.authenticate(['username'], onIncompletePaymentFound);
                document.getElementById("status").innerText = "أهلاً بك: " + auth.user.username;
                document.getElementById("pi-login-btn").style.display = "none";
            } catch (err) {
                console.error(err);
                alert("يرجى فتح التطبيق من متصفح Pi Browser.");
            }
        }

        function onIncompletePaymentFound(payment) {
            console.log("Incomplete payment", payment);
        }

        // --- ثانياً: بيانات الأذكار (تم التعديل والإضافة) ---
        const azkarData = [
            { id: 1, text: "اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ مَنْ ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلَّا بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلَا يُحِيطُونَ بِشَيْءٍ مِنْ عِلْمِهِ إِلَّا بِمَا شَاءَ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ وَلَا يَئُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ", count: 1 },
            { id: 2, text: "قُلْ هُوَ اللَّهُ أَحَدٌ (1) اللَّهُ الصَّمَدُ (2) لَمْ يَلِدْ وَلَمْ يُولَدْ (3) وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ", count: 3 },
            { id: 3, text: "قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ (1) مِنْ شَرِّ مَا خَلَقَ (2) وَمِنْ شَرِّ غَاسِقٍ إِذَا وَقَبَ (3) وَمِنْ شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ (4) وَمِنْ شَرِّ حَاسِدٍ إِذَا حَسَدَ", count: 3 },
            { id: 4, text: "قُلْ أَعُوذُ بِرَبِّ النَّاسِ (1) مَلِكِ النَّاسِ (2) إِلَهِ النَّاسِ (3) مِنْ شَرِّ الْوَسْوَاسِ الْخَنَّاسِ (4) الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ (5) مِنَ الْجِنَّةِ وَالنَّاسِ", count: 3 },
            { id: 5, text: "أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذَا الْيَوْمِ وَخَيْرَ مَا بَعْدَهُ، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذَا الْيَوْمِ وَشَرِّ مَا بَعْدَهُ، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ، وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ", count: 1 },
            { id: 6, text: "اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ وَإِلَيْكَ النُّشُورُ", count: 1 },
            { id: 7, text: "أَصْبَحْنَا عَلَى فِطْرَةِ الْإِسْلَامِ، وَعَلَى كَلِمَةِ الْإِخْلَاصِ، وَعَلَى دِينِ نَبِيِّنَا مُحَمَّدٍ ﷺ، وَعَلَى مِلَّةِ أَبِينَا إِبْرَاهِيمَ حَنِيفاً مُسْلِماً وَمَا كَانَ مِنَ الْمُشْرِكِينَ", count: 1 },
            { id: 8, text: "اللَّهُمَّ إِنِّي أَصْبَحْتُ أُشْهِدُكَ وَأُشْهِدُ حَمَلَةَ عَرْشِكَ، وَمَلَائِكَتَكَ وَجَمِيعَ خَلْقِكَ، أَنَّكَ أَنْتَ اللَّهُ لَا إِلَهَ إِلَّا أَنْتَ وَحْدَكَ لَا شَرِيكَ لَكَ، وَأَنَّ مُحَمَّدًا عَبْدُكَ وَرَسُولُكَ", count: 4 },
            { id: 9, text: "اللَّهُمَّ مَا أَصْبَحَ بِي مِنْ نِعْمَةٍ أَوْ بِأَحَدٍ مِنْ خَلْقِكَ فَمِنْكَ وَحْدَكَ لَا شَرِيكَ لَكَ، فَلَكَ الْحَمْدُ وَلَكَ الشُّكْرُ", count: 1 },
            { id: 10, text: "اللَّهُمَّ عَافِنِي فِي بَدَنِي، اللَّهُمَّ عَافِنِي فِي سَمْعِي، اللَّهُمَّ عَافِنِي فِي بَصَرِي، لَا إِلَهَ إِلَّا أَنْتَ", count: 3 },
            { id: 11, text: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْكُفْرِ، وَالْفَقْرِ، وَأَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، لَا إِلَهَ إِلَّا أَنْتَ", count: 3 },
            { id: 12, text: "حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ", count: 7 },
            { id: 13, text: "اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي الدُّنْيَا وَالْآخِرَةِ، اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ: فِي دِينِي وَدُنْيَايَ وَأَهْلِي، وَمَالِي، اللَّهُمَّ اسْتُرْ عَوْرَاتِي، وَآمِنْ رَوْعَاتِي، اللَّهُمَّ احْفَظْنِي مِنْ بَيْنِ يَدَيَّ، وَمِنْ خَلْفِي، وَعَنْ يَمِينِي، وَعَنْ شِمَالِي، وَمِنْ فَوْقِي، وَأَعُوذُ بِعَظَمَتِكَ أَنْ أُغْتَالَ مِنْ تَحْتِي", count: 1 },
            { id: 14, text: "اللَّهُمَّ عَالِمَ الغَيْبِ وَالشَّهَادَةِ فَاطِرَ السَّمَاوَاتِ وَالْأَرْضِ، رَبَّ كُلِّ شَيْءٍ وَمَلِيكَهُ، أَشْهَدُ أَنْ لَا إِلَهَ إِلَّا أَنْتَ، أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي، وَمِنْ شَرِّ الشَّيْطَانِ وَشِرْكِهِ، وَأَنْ أَقْتَرِفَ عَلَى نَفْسِي سُوءاً، أَوْ أَجُرَّهُ إِلَى مُسْلِمٍ", count: 1 },
            { id: 15, text: "بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الْأَرْضِ وَلَا فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ", count: 3 },
            { id: 16, text: "رَضِيتُ بِاللَّهِ رَبَّاً، وَبِالْإِسْلَامِ دِيناً، وَبِمُحَمَّدٍ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ نَبِيّاً", count: 3 },
            { id: 17, text: "يَا حَيُّ يَا قَيُّومُ بِرَحْمَتِكَ أَسْتَغِيثُ أَصْلِحْ لِي شَأْنِي كُلَّهُ وَلَا تَكِلْنِي إِلَى نَفْسِي طَرْفَةَ عَيْنٍ", count: 1 },
            { id: 18, text: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ: عَدَدَ خَلْقِهِ، وَرِضَا نَفْسِهِ، وَزِنَةَ عَرْشِهِ، وَمِدَادَ كَلِمَاتِهِ", count: 3 },
            { id: 19, text: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ", count: 100 },
            { id: 20, text: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ", count: 100 },
            { id: 21, text: "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ (مرة واحدة عند الكسل)", count: 1 },
            { id: 22, text: "لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ", count: 100 },
            { id: 23, text: "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا", count: 1 },
            { id: 24, text: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ", count: 3 },
            { id: 25, text: "اللَّهُمَّ صَلِّ وَسَلِّمْ عَلَى نَبِيِّنَا مُحَمَّدٍ", count: 10 },
            { id: 26, text: "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ عَلَيْكَ تَوَكَّلْتُ وَأَنْتَ رَبُّ الْعَرْشِ الْعَظِيمِ، مَا شَاءَ اللَّهُ كَانَ وَمَا لَمْ يَشَأْ لَمْ يَكُنْ", count: 1 },
            { id: 27, text: "أَسْتَغْفِرُ اللَّهَ وَأَتُوبُ إِلَيْهِ", count: 100 },
            { id: 28, text: "سُبْحَانَ اللَّهِ الْعَظِيمِ وَبِحَمْدِهِ", count: 100 },
            
            /* -- التعديلات والإضافات المطلوبة -- */
            
            { id: 29, text: "اللَّهُمَّ يَا مُقَلِّبَ الْقُلُوبِ ثَبِّتْ قَلْبِي عَلَى دِينِكَ", count: 3 }, /* تم تعديل الصيغة */
            
            { id: 30, text: "أَسْتَغْفِرُ اللَّهَ الْعَظِيمَ الَّذِي لَا إِلَهَ إِلَّا هُوَ الْحَيَّ الْقَيُّومَ وَأَتُوبُ إِلَيْهِ", count: 3 }, /* إضافة جديدة 1 */
            
            { id: 31, text: "يَا رَبِّ لَكَ الْحَمْدُ كَمَا يَنْبَغِي لِجَلَالِ وَجْهِكَ وَلِعَظِيمِ سُلْطَانِكَ", count: 1 } /* إضافة جديدة 2 */
        ];

        function loadAzkar() {
            const listContainer = document.getElementById('azkar-list');
            listContainer.innerHTML = '';
            
            azkarData.forEach(item => {
                const savedCount = localStorage.getItem(`zekr_${item.id}`) || item.count;
                const isCompleted = savedCount == 0;
                
                const card = document.createElement('div');
                card.className = `zekr-card ${isCompleted ? 'completed' : ''}`;
                // خاصية الاهتزاز عند النقر (إذا كان الهاتف يدعم ذلك)
                card.onclick = () => {
                    decrement(item.id);
                    if (navigator.vibrate) navigator.vibrate(20); 
                };

                card.innerHTML = `
                    <span class="zekr-text">${item.text}</span>
                    <div class="controls">
                        <span class="info">التكرار: ${item.count}</span>
                        <button class="counter-btn">${isCompleted ? '✔' : savedCount}</button>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }

        function decrement(id) {
            let current = parseInt(localStorage.getItem(`zekr_${id}`) || azkarData.find(a => a.id === id).count);
            if (current > 0) {
                current--;
                localStorage.setItem(`zekr_${id}`, current);
                loadAzkar();
            }
        }

        // --- وظائف النافذة المنبثقة (Modal) بدلاً من Alert ---
        function showResetModal() {
            document.getElementById('custom-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('custom-modal').style.display = 'none';
        }

        function confirmReset() {
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if(key.startsWith('zekr_')) localStorage.removeItem(key);
            });
            loadAzkar();
            closeModal();
        }

        window.onload = loadAzkar;
    </script>
</body>
</html>

